/*! archerTarget.js | v0.3.5 | https://github.com/archer96/archerTarget.js | (c) 2013 Andre Meyering | Licensed MIT */ 
!function(a,b,c){"use strict";function d(){var b,c=0,d=["ms","moz","webkit","o"];for(b=0;b<d.length&&!a.requestAnimationFrame;b++)a.requestAnimationFrame=a[d[b]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[d[b]+"CancelAnimationFrame"]||a[d[b]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(b){var d=(new Date).getTime(),e=Math.max(0,16-(d-c)),f=a.setTimeout(function(){b(d+e)},e);return c=d+e,f}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}function e(a,b,c){for(var d=0,e=a.length;e>d;d++)a[d].addEventListener(b,c,!1)}function f(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName}function g(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function h(a){return a&&"[object Function]"===Object.prototype.toString.call(a)}function i(a){return a&&"[object Array]"===Object.prototype.toString.call(a)}function j(a){return!(a instanceof Array||"number"==typeof a||"string"==typeof a||"boolean"==typeof a||f(a)||g(a)||h(a))}function k(a,b,c){for(var d=0,e=a.length;e>d;d++)a[d].removeEventListener(b,c,!1)}"undefined"==typeof a.DEVMODE&&(a.DEVMODE=0);var l="archerTarget",m={target:"wa_x",targetDefaults:{center:[50,50],diameter:90,style:{initial:{opacity:1},hover:{opacity:1},arrowOn:{opacity:1},arrowOff:{opacity:.8}}},arrows:{},arrowDefaults:{active:!0,draggable:!0,radius:5,style:{initial:{opacity:.9,color:"#00ff00",stroke:!1},hover:{opacity:1},selected:{opacity:1}},target:0},backgroundColor:"transparent",draggable:!0,scale:1,maxScale:6,minScale:.6,scaleStep:.2,scalable:!0,zoomInButton:"+",zoomOutButton:"&#x2212;",transX:0,transY:0,arrowClass:"arrow",plugins:{},isTouch:null},n={onTargetOver:"targetOver",onTargetOut:"targetOut",onTargetMove:"targetMove",onTargetClick:"targetClick",onArrowOver:"arrowOver",onArrowOut:"arrowOut",onArrowMove:"arrowMove",onArrowSelect:"arrowSelect",onArrowDeselect:"arrowDeselect",onScale:"zoom",onContainerTap:"containerTap",onContainerMousedown:"containerMousedown"},o={};a.ArcherTarget=function(a,b){if("undefined"==typeof this)throw new Error('"this" is undefined. use "new ArcherTarget(...)"and NOT "ArcherTarget(...)"');var c=this;if(a.id||(a.id=ArcherTarget.GUID()),c._id=a.id,o[c._id])for(var d in n)n.hasOwnProperty(d)&&o[c._id].options[d]&&a.removeEventListener(n[d]+".archerTarget",o[c._id].options[d],!1);return o[c._id]=new p(a,b),c},ArcherTarget.addTarget=function(a,b){p.Targets[a]=b},ArcherTarget.addPlugin=function(a,b){p.Plugins[a]=b};var p=function(a,b){var c=this;c._name=l,c._defaults=m,c._id=a.id,c.options=ArcherTarget.extend(!0,{},m,b),c.container=a,c.containerId=c._id,c.eventListeners=[];for(var d in n)n.hasOwnProperty(d)&&b[d]&&a.addEventListener(n[d]+".archerTarget",b[d],!1);c.init()};p.Targets={},p.Plugins={},ArcherTarget.prototype.removeEventListeners=function(){var a=o[this._id];try{for(var b=0;b<a.eventListeners.length;b++)a.eventListeners[b]();a.eventListeners=[]}catch(c){console.error("ArcherTarget.js ::",c)}},ArcherTarget.GUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"===a?b:8|3&b;return c.toString(16)})},p.prototype.bindArrowEvents=function(){var b,c,d,f,g,h,i,j,l=this,m={},n={},o=ArcherTarget.offset(l.container).left,p=ArcherTarget.offset(l.container).top,q=0;l.arrowMoving=!1,f=function(){if(!l.arrowMoving||!n.data.draggable)return!1;if(m.el.setPosition({x:c,y:d}),n.data.draggable instanceof Object&&l.setArrowPointer({x:c,y:d,drag:n.data.draggable,arrowRadius:n.data.radius}),m.ring=l.calculateRing({x:c,y:d-q,target:b}),m.x=l.convertTo.pcX(c,b),m.y=l.convertTo.pcY(d-q,b),m.ring=m.ring,!l.checkOnTarget(m)){var e=l.checkClosestTarget(b,{x:c,y:d});b!==e&&(m.target=b=e,l.setTargetStyle("arrow",{active:b}))}l.arrowList[n.id]=n.data,l.arrowList[n.id].data[m.id]=m,a.requestAnimationFrame(f),ArcherTarget.fireEvent(m.el,"arrowMove.archerTarget",{arrowset:n.id,arrow:m.id,arrows:l.arrowList})},g=function(a){return l.arrowMoving&&(c=a.pageX-o,d=a.pageY-p),!1},h=function(e){var g=e.target;if(!l.arrowMoving){var h,i=this.parentNode,j=g.className.baseVal;n.id=parseInt(i.id.substr(i.id.indexOf("_")+1),10),n.data=l.arrowList[n.id],b=n.data.target,h=-1===j.indexOf(" ")?parseInt(j,10):parseInt(j.substr(0,j.indexOf(" ")),10),m=n.data.data[h],m.el=this,m.id=h}return"mousedown"===e.type?(c=e.pageX-o||l.convertTo.pxX(m.x,b),d=e.pageY-p||l.convertTo.pxY(m.y,b),l.arrowMoving=!0,n.data.draggable&&(l.setTargetStyle("arrow",{active:b}),l.container.style.cursor="move"),m.el.setAttribute("fill",n.data.style.selected.color),m.el.style.opacity=n.data.style.selected.opacity,ArcherTarget.fireEvent(m.el,"arrowSelect.archerTarget",{arrowset:n.id,arrow:m.id,arrows:l.arrowList}),n.data.draggable instanceof Object&&n.data.draggable?(l.createArrowPointer({x:l.convertTo.pxX(m.x,b),y:l.convertTo.pxY(m.y,b),drag:n.data.draggable,color:n.data.style.selected.color,arrowRadius:n.data.radius}),q=n.data.draggable.height+n.data.radius):q=0,a.cancelAnimationFrame(f),a.requestAnimationFrame(f)):"mouseover"!==e.type||l.arrowMoving||(m.el.setAttribute("fill",n.data.style.hover.color),m.el.style.opacity=n.data.style.hover.opacity,ArcherTarget.fireEvent(m.el,"arrowOver.archerTarget",{arrowset:n.id,arrow:m.id,arrows:l.arrowList})),!1},i=function(){return l.arrowMoving&&(l.arrowMoving=!1,l.setTargetStyle("initial"),m.el.setAttribute("fill",n.data.style.hover.color),n.data.draggable instanceof Object&&(l.removeArrowPointer(),m.el.setPosition({x:l.convertTo.pxX(m.x,b),y:l.convertTo.pxY(m.y,b)})),l.container.style.cursor="default",ArcherTarget.fireEvent(l.container,"arrowDeselect.archerTarget",{arrowset:n.id,arrow:m.id,arrows:l.arrowList})),!1},j=function(){return l.arrowMoving&&n.data.draggable||(m.el.setAttribute("fill",n.data.style.initial.color),m.el.style.opacity=n.data.style.initial.opacity,ArcherTarget.fireEvent(m.el,"arrowOut.archerTarget",{arrowset:n.id,arrow:m.id,arrows:l.arrowList})),!1},this.container.addEventListener("mousemove",g),this.container.addEventListener("mouseup",i),this.container.addEventListener("click",i);var r=this.container.querySelectorAll(".arrowSetCanvas circle");e(r,"mouseout",j),e(r,"mousedown",h),e(r,"mouseover",h),l.eventListeners.push(function(){this.container.removeEventListener("mousemove",g),this.container.removeEventListener("mouseup",i),this.container.removeEventListener("click",i),k(r,"mouseout",j),k(r,"mousedown",h),k(r,"mouseover",h)})},p.prototype.bindArrowTouchEvents=function(){var b,c,d,f,g,h,i,j,l,m,n=this,o={},p={},q=0;n.arrowMoving=!1,i=function(){if(!n.arrowMoving||!p.data.draggable)return!1;if(o.el.setPosition({x:c,y:d}),p.data.draggable instanceof Object&&n.setArrowPointer({x:c,y:d,drag:p.data.draggable,arrowRadius:p.data.radius}),o.ring=n.calculateRing({x:c,y:d-q,target:b}),o.x=n.convertTo.pcX(c,b),o.y=n.convertTo.pcY(d-q,b),!n.checkOnTarget(o)){var e=n.checkClosestTarget(b,{x:c,y:d});b!==e&&(o.target=b=e,n.setTargetStyle("arrow",{active:b}))}n.arrowList[p.id]=p.data,n.arrowList[p.id].data[o.id]=o,a.requestAnimationFrame(i),ArcherTarget.fireEvent(o.el,"arrowMove.archerTarget",{arrowset:p.id,arrow:o.id,arrows:n.arrowList})},j=function(a){return n.arrowMoving?(h=a.touches[0],c=h.pageX-f,d=h.pageY-g,!1):!1},l=function(e){var j=e.target;if(!n.arrowMoving){f=ArcherTarget.offset(n.container).left,g=ArcherTarget.offset(n.container).top;var k,l=j.parentNode,m=j.className.baseVal;p.id=parseInt(l.id.substr(l.id.indexOf("_")+1),10),p.data=n.arrowList[p.id],b=p.data.target,k=-1===m.indexOf(" ")?parseInt(m,10):parseInt(m.substr(0,m.indexOf(" ")),10),o=p.data.data[k],o.el=j,o.id=k}return h=e.touches[0],h.noOffset?(c=h.pageX||n.convertTo.pxX(o.x||0,b),d=h.pageY||n.convertTo.pxY(o.y||0,b)):(c=h.pageX-f||n.convertTo.pxX(o.x||0,b),d=h.pageY-g||n.convertTo.pxY(o.y||0,b)),n.arrowMoving=!0,p.data.draggable&&(n.setTargetStyle("arrow",{active:b}),n.container.style.cursor="move"),o.el.setAttribute("fill",p.data.style.selected.color),o.el.style.opacity=p.data.style.selected.opacity,ArcherTarget.fireEvent(o.el,"arrowSelect.archerTarget",{arrowset:p.id,arrow:o.id,arrows:n.arrowList}),p.data.draggable instanceof Object&&p.data.draggable?(n.createArrowPointer({x:n.convertTo.pxX(o.x,b),y:n.convertTo.pxY(o.y,b),drag:p.data.draggable,color:p.data.style.selected.color,arrowRadius:p.data.radius}),q=p.data.draggable.height+p.data.radius):q=0,1===e.touches.length&&p.data.draggable&&(a.cancelAnimationFrame(i),a.requestAnimationFrame(i)),!1},m=function(){return n.arrowMoving?(n.arrowMoving=!1,n.setTargetStyle("initial"),o.el.setAttribute("fill",p.data.style.hover.color),p.data.draggable instanceof Object&&(n.removeArrowPointer(),o.el.setPosition({x:n.convertTo.pxX(o.x,b),y:n.convertTo.pxY(o.y,b)})),n.container.style.cursor="default",ArcherTarget.fireEvent(n.container,"arrowDeselect.archerTarget",{arrowset:p.id,arrow:o.id,arrows:n.arrowList}),!1):!1},n.container.addEventListener("touchmove",j),n.container.addEventListener("touchend",m),e(n.container.querySelectorAll(".arrowSetCanvas circle"),"touchstart",l),n.eventListeners.push(function(){n.container.removeEventListener("touchstart",j),n.container.removeEventListener("touchend",m),k(n.container.querySelectorAll(".arrowSetCanvas circle"),"touchstart",l)})},p.prototype.bindContainerEvents=function(){var b=this,d=!1;if(this.options.draggable){var f,g,h,i,j,l,m,n,o=!1,p=this.container.getElementsByTagName("svg")[0];j=function(){o&&(b.transX=(h-f)/b.scale,b.transY=(i-g)/b.scale,d=!0,b.setTransform(),a.requestAnimationFrame(j),ArcherTarget.fireEvent(b.container,"targetMove.archerTarget"))},l=function(a){o&&(h=a.pageX,i=a.pageY)},m=function(c){f=c.pageX-b.transX*b.scale,g=c.pageY-b.transY*b.scale,h=c.pageX,i=c.pageY,o=!0,d=!1,p.style.cursor="move",a.cancelAnimationFrame(j),a.requestAnimationFrame(j)},n=function(){o=d=!1,p.style.cursor="default"};var q=this.container.querySelectorAll("svg .targetCanvas");e(q,"mousemove",l),e(q,"mousedown",m),e(q,"mouseup",n),b.eventListeners.push(function(){k(q,"mousemove",l),k(q,"mousedown",m),k(q,"mouseup",n)})}var r=function(a){var e=typeof a.target.className.baseVal!==c?a.target.className.baseVal:a.target.className;if(a.target,!d&&null===e.match(/archerTarget-zoomin/g)&&null===e.match(/archerTarget-zoomout/g)){var f=a.pageX-ArcherTarget.offset(b.container).left,g=a.pageY-ArcherTarget.offset(b.container).top,h=b.checkClosestTarget(0,{x:f,y:g}),i=[{x:100*(f/b.width),y:100*(g/b.height),xPx:f,yPx:g},{x:b.convertTo.pcX(f,h),y:b.convertTo.pcY(g,h),target:h}];"mousedown"===a.type?ArcherTarget.fireEvent(b.container,"containerMousedown.archerTarget",{canvasCoords:i[0],targetCoords:i[1]}):ArcherTarget.fireEvent(b.container,"containerTap.archerTarget",{canvasCoords:i[0],targetCoords:i[1]})}};b.container.addEventListener("mousedown",r),b.container.addEventListener("click",r),b.eventListeners.push(function(){b.container.removeEventListener("mousedown",r),b.container.removeEventListener("click",r)})},p.prototype.bindContainerTouchEvents=function(){var b,d=this,f=!1;if(this.options.draggable){var g,h,i,j,l,m,n,o,p=!1,q=this.container.getElementsByTagName("svg")[0];l=function(){p&&(d.transX=(i-g)/d.scale,d.transY=(j-h)/d.scale,f=!0,d.setTransform(),a.requestAnimationFrame(l),ArcherTarget.fireEvent(d.container,"targetMove.archerTarget"))},m=function(a){p&&!d.arrowMoving&&(b=a.touches[0],i=b.pageX,j=b.pageY)},n=function(c){d.arrowMoving||(b=c.touches[0],g=b.pageX-d.transX*d.scale,h=b.pageY-d.transY*d.scale,i=b.pageX,j=b.pageY,p=!0,f=!1,q.style.cursor="move",a.cancelAnimationFrame(l),a.requestAnimationFrame(l))},o=function(){d.arrowMoving||(p=f=!1,q.style.cursor="default")};var r=d.container.querySelectorAll("svg .targetCanvas");e(r,"touchmove",m),e(r,"touchstart",n),e(r,"touchend",o),d.eventListeners.push(function(){k(r,"touchmove",m),k(r,"touchstart",n),k(r,"touchend",o)})}var s=function(a){if(!d.arrowMoving){var e=typeof a.target.className.baseVal!==c?a.target.className.baseVal:a.target.className;if(a.target,!f&&null===e.match(/archerTarget-zoomin/g)&&null===e.match(/archerTarget-zoomout/g)){var g,h,i,j,k=ArcherTarget.offset(d.container).left,l=ArcherTarget.offset(d.container).top;"touchstart"===a.type?(b=event.touches[0],g=b.pageX-k,h=b.pageY-l):(b=event.changedTouches[0],g=b.pageX-k,h=b.pageY-l),i=d.checkClosestTarget(0,{x:g,y:h}),j=[{x:100*(g/d.width),y:100*(h/d.height),xPx:g,yPx:h},{x:d.convertTo.pcX(g,i),y:d.convertTo.pcY(h,i),target:i},a],"touchstart"===a.type?ArcherTarget.fireEvent(d.container,"containerMousedown.archerTarget",{canvasCoords:j[0],targetCoords:j[1],touches:a.touches}):ArcherTarget.fireEvent(d.container,"containerTap.archerTarget",{canvasCoords:j[0],targetCoords:j[1],touches:a.touches})}}};d.container.addEventListener("touchstart",s),d.container.addEventListener("touchend",s),d.eventListeners.push(function(){d.container.removeEventListener("touchstart",s),d.container.removeEventListener("touchend",s)})},p.prototype.bindTargetEvents=function(){function a(a,b){var c=b.el;c.addEventListener("click",function(){ArcherTarget.fireEvent(b.el,"targetClick.archerTarget",{index:a})})}for(var b=this,c=0;c<b.targetList.length;c++)a(c,b.targetList[c])},p.prototype.bindTargetTouchEvents=function(){function a(a,c){var d=function(){ArcherTarget.fireEvent(c.el,"targetClick.archerTarget",{index:a})};c.el.parentNode.addEventListener("touchend",d),b.eventListeners.push(function(){c.el.parentNode.removeEventListener("touchend",d)})}for(var b=this,c=0;c<b.targetList.length;c++)a(c,b.targetList[c])},p.prototype.bindZoomEvents=function(){function a(){c.scale<=c.options.maxScale&&(d=c.scale+c.options.scaleStep),c.setZoom(d)}function b(){c.scale>=c.options.minScale+c.options.scaleStep&&(d=c.scale-c.options.scaleStep),c.setZoom(d)}var c=this,d=0,e=this.container;e.querySelector(".archerTarget-zoomin").addEventListener("click",a),e.querySelector(".archerTarget-zoomout").addEventListener("click",b),c.eventListeners.push(function(){e.querySelector(".archerTarget-zoomin").removeEventListener("click",a),e.querySelector(".archerTarget-zoomout").removeEventListener("click",b)})},p.prototype.calculateRing=function(a){var b,c,d=this,e=d.targetList[a.target],f=p.Targets[e.name],g={x:0,y:0,diagonal:0},h={x:(d.convertTo.canvasX(e.center[0])+d.transX)*d.scale,y:(d.convertTo.canvasY(e.center[1])+d.transY)*d.scale,radius:d.convertTo.canvasX(e.diameter)/2*d.scale,numberRings:f.numberRings};if(g.x=a.x>=h.x?h.x-a.x:a.x-h.x,g.y=a.y>=h.y?a.y-h.y:h.y-a.y,g.diagonal=0===g.x&&0===g.y?0:Math.sqrt(Math.pow(g.x,2)+Math.pow(g.y,2)),g.diagonal>h.radius+1)return 0;for(b=h.numberRings-1;b>=0;b--)if(c=d.convertTo.canvasX(f.diameters[b],e.diameter)/2*d.scale+1,g.diagonal<=c)return f.rating[b]},p.prototype.checkClosestTarget=function(a,b){var c,d,e,f,g,h=this,i=h.targetList.length;for(c=0;i>c;c++)if(g=h.targetList[c],d=(h.convertTo.canvasX(g.center[0])+h.transX)*h.scale,e=(h.convertTo.canvasY(g.center[1])+h.transY)*h.scale,f=h.convertTo.canvasX(g.diameter)/2*h.scale,b.x>d-f&&b.x<d+f&&b.y>e-f&&b.y<e+f)return c;return a},p.prototype.checkOnTarget=function(a,b){if(this.targetList.length<=1)return!0;var c=b&&b.tolerance?b:{tolerance:5};return a.x>100+c.tolerance||a.y>100+c.tolerance||a.x<-c.tolerance||a.y<-c.tolerance?!1:!0},p.prototype.createArrowPointer=function(a){var b=this;b.dragMark={},b.dragMark.el=b.canvas.createGroup({id:b.$containerId+"ArrowDrag"}),b.dragMark.rect=b.canvas.createRect({x:a.x-a.drag.width/2,y:a.y-a.drag.height-a.arrowRadius,width:a.drag.width,height:a.drag.height,fill:a.color}),b.dragMark.el.appendChild(b.dragMark.rect),b.dragMark.circle=b.canvas.createCircle({x:a.x,y:a.y-a.drag.height-a.arrowRadius,radius:a.drag.width,fill:a.color,stroke:!1,eleClass:!1}),b.dragMark.el.appendChild(b.dragMark.circle),b.canvas.canvas.appendChild(b.dragMark.el)},p.prototype.createArrows=function(a){a||(a=[]);var b,c,d,e,f,g,h=this,i={height:40,width:5},j=a.length;for(h.arrowGroup=h.canvas.createGroup({id:h.containerId+"ArrowGroup"}),b=0;j>b;b++){for(a[b]=e instanceof Array?{data:a[b]}:a[b],a[b]=ArcherTarget.extend(!0,{},h.options.arrowDefaults,a[b]),e=a[b],e.draggable instanceof Object&&(e.draggable=ArcherTarget.extend(!0,{},i,e.draggable)),e.el=h.canvas.createGroup({id:h.containerId+"ArrowSet_"+b,eleClass:"arrowSetCanvas"}),f=e.data.length,c=0;f>c;c++)g=e.data[c],h.targetList[e.target]||(e.target=0),g.target=g.target||e.target,h.targetList[g.target]||(g.target=0),"undefined"==typeof g.active&&(g.active=e.active),d=g.active?"":" hidden",g.el=h.canvas.createCircle({x:h.convertTo.pxX(g.x,g.target),y:h.convertTo.pxY(g.y,g.target),radius:e.radius,fill:e.style.initial.color,stroke:e.style.initial.stroke,eleClass:c+d}),g.el.style.opacity=e.style.initial.opacity,e.el.appendChild(g.el);h.arrowGroup.appendChild(e.el)}return h.canvas.canvas.appendChild(h.arrowGroup),a},p.prototype.createTarget=function(a){var b,c,d,e,f=this;for(a=a||[],b=0;b<a.length;b++){for(a[b]=ArcherTarget.extend(!0,{},this.options.targetDefaults,a[b]),d=a[b],d.originalCenter=d.center,d.el=this.canvas.createGroup({id:f.containerId+"Target_"+b,eleClass:"targetCanvas"}),d.rings=[],c=0;c<p.Targets[d.name].numberRings;c++)d.rings[c]={},e=p.Targets[d.name].diameters[c],d.rings[c].el=this.canvas.createCircle({x:f.convertTo.canvasX(d.center[0]),y:f.convertTo.canvasY(d.center[1]),radius:f.convertTo.canvasX(e,d.diameter)/2,fill:p.Targets[d.name].colors[c],stroke:p.Targets[d.name].strokeColors[c],eleClass:c}),d.el.appendChild(d.rings[c].el);d.el.style.opacity=d.style.initial.opacity,this.targetGroup.appendChild(d.el)}return a},ArcherTarget.extend=function(){var a,b,d,e,f,g,k=arguments[0]||{},l=1,m=arguments.length,n=!1;for("boolean"==typeof k&&(n=k,k=arguments[1]||{},l=2),"object"!=typeof k&&h(k)&&(k={}),m===l&&(k=this,--l);m>l;l++)if(null!==(f=arguments[l]))for(e in f)if(f.hasOwnProperty(e)){if(a=k[e],d=f[e],k===d)continue;n&&d&&(j(d)||(b=i(d)))?(b?(b=!1,g=a&&i(a)?a:[]):g=a&&j(a)?a:{},k[e]=ArcherTarget.extend(n,g,d)):d!==c&&(k[e]=d)}return k},ArcherTarget.fireEvent=function(a,c,d){var e=b.createEvent("Event");if(e.initEvent(c,!0,!0),d)for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);a.dispatchEvent(e)},ArcherTarget.prototype.get=p.prototype.get=function(a){var b,c=o[this._id];return b={arrows:function(){return c.getArrows()},targetParams:function(a){return q(a)}},a&&b[a]?arguments[1]?b[a].apply(null,Array.prototype.slice.call(arguments,1)):b[a]():void 0},p.prototype.getArrows=function(){return this.arrowList},p.prototype.getRing=function(a){var b=this;if(a)return b.calculateRing({x:b.convertTo.pxX(a.x,a.target),y:b.convertTo.pxY(a.y,a.target),target:a.target});var c,d,e;for(c=0;c<this.arrow.length;c++)for(d=0;d<this.arrow[c].data.length;d++)e=this.arrow[c].data[d],e.ring=b.calculateRing({x:b.convertTo.pxX(e.x,e.target),y:b.convertTo.pxY(e.y,e.target),target:e.target});return this.arrow},p.prototype.getSize=function(){var b=a.getComputedStyle(this.container,null);if(this.width=b.width,this.height=b.height||this.width,this.width.indexOf("px")>=0){var c=this.width;this.width=c.substr(0,c.length-2)}if(this.height.indexOf("px")>=0){var d=this.height;this.height=d.substr(0,d.length-2)}};var q=ArcherTarget.getTarget=function(a){return p.Targets[a]||{}};p.prototype.getTransform=function(){return{x:this.transX,y:this.transY,scale:this.scale}},p.prototype.init=function(){var a=this;if(a.container.className+=" archerTargetContainer",a.container.style.overflow="hidden",a.container.style.position="relative",a.transX=a.options.transX,a.transY=a.options.transY,a.scale=a.options.scale,a.pluginList=a.options.plugins,a.mergeStyles(),a.setBackgroundColor(a.options.backgroundColor),a.initConverter(),d(),a.getSize(),a.canvas=new r(a.width,a.height),a.container.appendChild(a.canvas.canvas),a.targetGroup=a.canvas.createGroup({id:a.containerId+"TargetGroup"},!0),a.canvas.canvas.appendChild(a.targetGroup),a.targetList=a.createTarget(a.options.target instanceof Array?a.options.target:[{name:a.options.target}]),a.setGap(),this.arrowList=a.createArrows(a.options.arrows),a.isTouch()?(a.bindContainerTouchEvents(),a.bindArrowTouchEvents(),a.bindTargetTouchEvents()):(a.bindContainerEvents(),a.bindArrowEvents(),a.bindTargetEvents()),a.options.scalable){var c=b.createElement("div"),e=b.createElement("div");c.className="archerTarget-zoomin",e.className="archerTarget-zoomout",c.innerHTML=a.options.zoomInButton,e.innerHTML=a.options.zoomOutButton,a.container.appendChild(c),a.container.appendChild(e),a.bindZoomEvents()}a.setTransform(),a.initPlugins()},p.prototype.initConverter=function(){var a=this,b={x:{},y:{}};a.convertTo={pcX:function(b,c){return c||(c=0),100*((b/a.scale-a.gap[c].left-a.transX)/a.convertTo.canvasX(a.targetList[c].diameter))},pcY:function(b,c){return c||(c=0),100*((b/a.scale-a.gap[c].top-a.transY)/a.convertTo.canvasX(a.targetList[c].diameter))},pxX:function(b,c){return c||(c=0),(a.convertTo.canvasX(a.targetList[c].diameter)/100*b+a.gap[c].left+a.transX)*a.scale},pxY:function(b,c){return c||(c=0),(a.convertTo.canvasX(a.targetList[c].diameter)/100*b+a.gap[c].top+a.transY)*a.scale},canvasX:function(c,d){d||(d=100),b.x[d]||(b.x[d]={});var e=b.x[d];return e[c]||(e[c]=a.width/100*d/100*c),e[c]},canvasY:function(c,d){d||(d=100),b.y[d]||(b.y[d]={});var e=b.y[d];return e[c]||(e[c]=a.height/100*d/100*c),e[c]}}},p.prototype.initPlugins=function(){var a;for(a in this.pluginList)this.pluginList.hasOwnProperty(a)&&p.Plugins[a]&&p.Plugins[a].initialize(this,this.pluginList[a])},p.prototype.isTouch=function(){var c=this;return null!==c.options.isTouch?c.options.isTouch:"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch||!1},p.prototype.mergeStyles=function(){var a,b=this,c=this.options;for(a in c.targetDefaults.style)c.targetDefaults.style.hasOwnProperty(a)&&(b.options.targetDefaults.style[a]=ArcherTarget.extend(!0,{},c.targetDefaults.style.initial,c.targetDefaults.style[a]));for(a in c.arrowDefaults.style)c.arrowDefaults.style.hasOwnProperty(a)&&(b.options.arrowDefaults.style[a]=ArcherTarget.extend(!0,{},c.arrowDefaults.style.initial,c.arrowDefaults.style[a]))},ArcherTarget.offset=function(b){if(0===b.length)return null;var c=b.getBoundingClientRect();return{left:c.left+a.pageXOffset,top:c.top+a.pageYOffset,width:Math.round(c.width),height:Math.round(c.height)}},p.prototype.removeArrowPointer=function(){this.canvas.canvas.removeChild(this.dragMark.el)},ArcherTarget.prototype.set=p.prototype.set=function(a){var b=o[this._id],c={arrowActive:function(a){b.setArrowActive(a)},arrowOptions:function(a){b.setArrowOptions(a)},transform:function(a,c,d){b.setTransform(a,c,d)}};return a&&c[a]?arguments[1]?c[a].apply(null,Array.prototype.slice.call(arguments,1)):c[a]():void 0},p.prototype.setArrowActive=function(a){var b=this,c=function(a,c,d){"undefined"==typeof d?d=b.arrowList[a].data[c].active:b.arrowList[a].data[c].active=d;var e=b.arrowList[a].data[c].el,f=d?"":" hidden";e.setAttribute("class",c+f)},d=function(a,d){var e;"undefined"!=typeof d&&(b.arrowList[a].active=d);var f=b.arrowList[a].data.length;for(e=0;f>e;e++)c(a,e,d)};"undefined"!=typeof a.arrowID?c(a.arrowsetID,a.arrowID,a.active):d(a.arrowsetID,a.active)},p.prototype.setArrowOptions=function(a){var b,c,d,e=this;d={active:function(b){e[b]({arrowsetID:a.arrowsetID,active:a.options.active})}};for(b in a.options)a.options.hasOwnProperty(b)&&(c="setArrow"+b.charAt(0).toUpperCase()+b.substr(1),a.options[b]!==e.arrowList[a.arrowsetID][b]&&d[b]&&d[b](c));ArcherTarget.extend(!0,e.arrowList[a.arrowsetID],a.options)},p.prototype.setArrowPointer=function(a){this.dragMark.rect.setPosition({x:a.x-a.drag.width/2,y:a.y-a.drag.height-a.arrowRadius}),this.dragMark.circle.setPosition({x:a.x,y:a.y-a.drag.height-a.arrowRadius})},p.prototype.setArrowPosition=function(a){var b,c,d=this,e=d.convertTo.pxX,f=d.convertTo.pxY,g={},h=function(a,b){var c=d.arrowList[a].data[b];c.el.setPosition({x:e(c.x,c.target),y:f(c.y,c.target)})};if("undefined"==typeof a)for(b=0;b<d.arrowList.length;b++)for(c=0;c<d.arrowList[b].data.length;c++)h(b,c);else if(a=ArcherTarget.extend(!0,{},g,a),a.arrowsetID instanceof Array)for(b=0;b<a.arrowsetID.length;b++)for(c=0;c<d.arrowList[a.arrowsetID[b]].data.length;c++)h(a.arrowsetID[b],c);else if("undefined"!=typeof a.arrowID)if(a.arrowID instanceof Array)for(b=0;b<a.arrowID.length;b++)h(a.arrowsetID,a.arrowID[b]);else h(a.arrowsetID,a.arrowID);else for(h(a.arrowsetID,a.active),b=0;b<d.arrowList[a.arrowsetID].data.length;b++)h(a.arrowsetID,b)},p.prototype.setArrowStyle=function(a){var b,c,d=this,e={style:d.options.arrowDefaults.style.initial},f=function(a,b){var e;for(b.radius||(b.radius=d.arrowList[a].radius),c=0;c<d.arrowList[a].data.length;c++)e=d.arrowList[a].data[c],e.el.setStyle({stroke:b.stroke,radius:b.radius,fill:b.color}),e.el.opacity=b.opacity},g=function(a,b,c){var e=d.arrowList[a].data[b];c.radius||(c.radius=d.arrowList[a].radius),e.el.setStyle({stroke:c.stroke,radius:c.radius,fill:c.color}),e.el.opacity=c.opacity};if(a=ArcherTarget.extend(!0,{},e,a),a.arrowsetID instanceof Array)if(a.style instanceof Array)for(b=0;b<a.arrowsetID.length;b++)f(a.arrowsetID[b],a.style[b]);else for(b=0;b<a.arrowsetID.length;b++)f(a.arrowsetID[b],a.style);else if("undefined"!=typeof a.arrowID)if(a.arrowID instanceof Array)if(a.style instanceof Array)for(b=0;b<a.arrowID.length;b++)g(a.arrowsetID,a.arrowID[b],a.style[b]);else for(b=0;b<a.arrowID.length;b++)g(a.arrowsetID,a.arrowID[b],a.style);else g(a.arrowsetID,a.arrowID,a.style);else f(a.arrowsetID,a.style)},p.prototype.setBackgroundColor=function(a){this.backgroundColor=this.container.style.backgroundColor=a},p.prototype.setGap=function(){var a,b,c=this;for(c.gap=[],a=0;a<c.targetList.length;a++)b=c.targetList[a],c.gap[a]={top:c.convertTo.canvasY(b.center[1])-c.convertTo.canvasX(b.diameter/2),left:c.convertTo.canvasX(b.center[0]-b.diameter/2)}},p.prototype.setTargetStyle=function(a,b){var c,d,e=this.targetList;d={initial:function(){for(c=0;c<e.length;c++)e[c].el.style.opacity=e[c].style.initial.opacity},arrow:function(){var a;for(c=0;c<e.length;c++)a=c===b.active?"arrowOn":"arrowOff",e[c].el.style.opacity=e[c].style[a].opacity}},d[a]&&d[a]()},p.prototype.setTransform=function(a,b,c){a||0===a?this.transX=a:a=this.transX,b||0===b?this.transY=b:b=this.transY,c?this.scale=c:c=this.scale,this.canvas.applyTransformParams(c,a,b),this.setArrowPosition()},p.prototype.setZoom=function(a){ArcherTarget.fireEvent(this.container,"zoom.archerTarget",{newScale:a,oldScale:this.scale}),this.scale=a,this.setTransform()};var r=function(c,d){a.SVGAngle||alert("No SVG supported!"),this.createSvgNode=function(a){return b.createElementNS("http://www.w3.org/2000/svg",a)},this.canvas=this.createSvgNode("svg"),this.setSize(c,d)};r.prototype={width:0,height:0,canvas:null,setSize:function(a,b){this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b),this.width=a,this.height=b},createCircle:function(a){var b=this.createSvgNode("circle");return b.setAttribute("cx",a.x),b.setAttribute("cy",a.y),b.setAttribute("r",a.radius),b.setAttribute("fill",a.fill),b.setAttribute("stroke",a.stroke),b.setAttribute("class",a.eleClass),b.setPosition=function(a){b.setAttribute("cx",a.x),b.setAttribute("cy",a.y)},b.setStyle=function(a){b.setAttribute("r",a.radius),b.setAttribute("fill",a.fill),b.setAttribute("stroke",a.stroke)},b},createRect:function(a){var b=this.createSvgNode("rect");return b.setAttribute("x",a.x),b.setAttribute("y",a.y),b.setAttribute("width",a.width),b.setAttribute("height",a.height),b.setAttribute("fill",a.fill),b.setPosition=function(a){b.setAttribute("x",a.x),b.setAttribute("y",a.y)},b},createGroup:function(a,b){var c=a||{},d=this.createSvgNode("g");return c.id&&(d.id=c.id),c.eleClass&&d.setAttribute("class",c.eleClass),b&&(this.rootGroup=d),d},applyTransformParams:function(a,b,c){this.rootGroup.setAttribute("transform","scale("+a+") translate("+b+", "+c+")")}}}(window,document);
/*
//@ sourceMappingURL=dist/archerTarget.min.map
*/