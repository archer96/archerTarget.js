/**
 * jArcherTarget version 0.2
 *
 * Copyright 2012, Andre Meyering
 * Licensed under the MIT license.
 */var jat={};(function(e){!1;var t={onTargetOver:"targetOver",onTargetOut:"targetOut",onTargetMove:"targetMove",onTargetClick:"targetClick",onArrowOver:"arrowOver",onArrowOut:"arrowOut",onArrowMove:"arrowMove",onArrowClick:"arrowClick",onArrowSelect:"arrowSelect",onArrowDeselect:"arrowDeselect",onZoom:"zoom",onContainerTap:"containerTap",onContainerMousedown:"containerMousedown"},n={get:{ring:1,targetParams:1,transform:1,arrows:1},set:{arrowOptions:1,arrowActive:1,arrowStyle:1,backgroundColor:1,zoom:1,transform:1}};e.fn.archerTarget=function(r){var i={target:"wa_x",targetDefaults:{center:[50,50],diameter:90,style:{initial:{opacity:1},hover:{opacity:1},arrowOn:{opacity:1},arrowOff:{opacity:.9}}},backgroundColor:"transparent",draggable:1,arrowDefaults:{active:1,draggable:1,radius:5,style:{initial:{opacity:.9,color:"#00ff00",stroke:!1},hover:{opacity:1},selected:{opacity:1}},target:0},zoom:1,maxZoom:6,minZoom:.6,zoomStep:.2,zoomable:1,transX:0,transY:0,plugins:{}},s,o,u,a;if(r==="addTarget")jat.Target.targets[arguments[1]]=arguments[2],!1;else if(r==="addPlugin")jat.Target.plugins[arguments[1]]=arguments[2],!1;else{if(!(r!=="set"&&r!=="get"||!n[r][arguments[1]]))return o=r+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1),this.data("targetObject")[o].apply(this.data("targetObject"),Array.prototype.slice.call(arguments,2));!1,!1,e.extend(!0,i,r);for(a in i.targetDefaults.style)i.targetDefaults.style.hasOwnProperty(a)&&(i.targetDefaults.style[a]=e.extend(!0,{},i.targetDefaults.style.initial,i.targetDefaults.style[a]));for(a in i.arrowDefaults.style)i.arrowDefaults.style.hasOwnProperty(a)&&(i.arrowDefaults.style[a]=e.extend(!0,{},i.arrowDefaults.style.initial,i.arrowDefaults.style[a]));i.container=this,s=new jat.Target(i),this.data("targetObject",s);for(u in t)t.hasOwnProperty(u)&&i[u]&&this.on(t[u]+".jArcherTarget",i[u])}return this},jat.Target=function(t){var n=this,r,i={canvas:{x:{},y:{}},px:{x:{},y:{}},pc:{x:{},y:{}}};t=t||{},this.params=t,this.container=t.container.addClass("archerTargetContainer").css({position:"relative",overflow:"hidden"}),this.plugins=t.plugins,this.arrowClass="arrow",this.zoom=t.zoom,this.maxZoom=t.maxZoom,this.minZoom=t.minZoom,this.zoomStep=t.zoomStep,this.draggable=t.draggable,this.zoomable=t.zoomable,this.transX=t.transX,this.transY=t.transY,this.arrowDrag=!1,this.setSize(),this.clearConverterCache=function(){i.px={x:{},y:{}},i.pc={x:{},y:{}}},this.convertTo={pc:{x:function(e,t){t||(t=0),i.pc.x[t]||(i.pc.x[t]={});var r=i.pc.x[t];return r[e]?!1:(!1,r[e]=(e/n.zoom-n.gap[t].left-n.transX)/n.convertTo.canvas.x(n.target[t].diameter)*100),r[e]},y:function(e,t){t||(t=0),i.pc.y[t]||(i.pc.y[t]={});var r=i.pc.y[t];return r[e]?!1:(!1,r[e]=(e/n.zoom-n.gap[t].top-n.transY)/n.convertTo.canvas.x(n.target[t].diameter)*100),r[e]}},px:{x:function(e,t){t||(t=0),i.px.x[t]||(i.px.x[t]={});var r=i.px.x[t];return r[e]?!1:(!1,r[e]=(n.convertTo.canvas.x(n.target[t].diameter)/100*e+n.gap[t].left+n.transX)*n.zoom),r[e]},y:function(e,t){t||(t=0),i.px.y[t]||(i.px.y[t]={});var r=i.px.y[t];return r[e]?!1:(!1,r[e]=(n.convertTo.canvas.x(n.target[t].diameter)/100*e+n.gap[t].top+n.transY)*n.zoom),r[e]}},canvas:{x:function(e,t){t||(t=100),i.canvas.x[t]||(i.canvas.x[t]={});var r=i.canvas.x[t];return r[e]?!1:(!1,r[e]=n.width/100*t/100*e),r[e]},y:function(e,t){t||(t=100),i.canvas.y[t]||(i.canvas.y[t]={});var r=i.canvas.y[t];return r[e]?!1:(!1,r[e]=n.height/100*t/100*e),r[e]}}},this.setBackgroundColor(t.backgroundColor),this.canvas=new jat.VectorCanvas(this.width,this.height),this.container.append(this.canvas.canvas),this.rootGroup=this.canvas.createGroup(!0,{id:this.container.attr("id")+"TargetContainer"}),this.canvas.canvas.appendChild(this.rootGroup),this.target=t.target instanceof Array?t.target:[{name:t.target}],this.target=this.createTarget(this.target),this.setGap(),this.arrow=this.createArrows(t.arrows),"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||this.params.touch===!0?(!1,this.bindContainerTouchEvents(),this.bindArrowTouchEvents(),this.bindTargetTouchEvents()):(!1,this.bindContainerEvents(),this.bindArrowEvents(),this.bindTargetEvents()),this.zoomable&&(e("<div/>").addClass("archerTarget-zoomin").text("+").appendTo(t.container),e("<div/>").addClass("archerTarget-zoomout").html("&#x2212;").appendTo(t.container)),this.bindZoomEvents(),this.setTransform();for(r in this.plugins)this.plugins.hasOwnProperty(r)&&jat.Target.plugins[r]&&jat.Target.plugins[r].initialize(this,this.plugins[r])},jat.Target.targets={},jat.Target.plugins={}})(jQuery),jat.Target.prototype.bindArrowEvents=function(){var e=this,t,n={},r={},i,s,o=0;this.container.on("mousemove",function(t){return e.arrowMoving&&r.data.draggable&&(i=t.pageX-this.offsetLeft,s=t.pageY-this.offsetTop,n.element.setPosition({x:i,y:s}),r.data.draggable instanceof Object&&e.setArrowPointer({x:i,y:s,drag:r.data.draggable,arrowRadius:r.data.radius}),n.ring=e.calculateRing({x:i,y:s-o,target:n.data.target}),n.data.x=e.convertTo.pc.x(i,n.data.target),n.data.y=e.convertTo.pc.y(s-o,n.data.target),n.data.ring=n.ring,e.checkOnTarget(n.data,{x:i,y:s})&&(n.target=e.checkClosestTarget(n.data.target,{x:i,y:s}),n.data.target!==n.target&&(n.data.target=n.target,e.setTargetStyle("arrow",{active:n.data.target}))),e.arrow[r.id]=r.data,e.arrow[r.id].data[n.id]=n.data,$(n.element).trigger("arrowMove.jArcherTarget",[r.id,n.id,e.arrow])),!1}),this.container.find(".arrowSetCanvas").on("mousedown mouseover","circle",function(t){return e.arrowMoving||(n.element=this,r.id=parseInt(n.element.parentNode.id.substr(n.element.parentNode.id.indexOf("_")+1),10),r.data=e.arrow[r.id],$(this).attr("class").indexOf(" ")===-1?n.id=parseInt($(this).attr("class"),10):n.id=parseInt($(this).attr("class").substr(0,$(this).attr("class").indexOf(" ")),10),n.data=r.data.data[n.id]),t.type==="mousedown"?(i=t.pageX-this.offsetLeft,s=t.pageY-this.offsetTop,e.arrowMoving=!0,r.data.draggable&&(e.setTargetStyle("arrow",{active:n.data.target}),$(e.container).css({cursor:"move"})),n.element.setAttribute("fill",r.data.style.selected.color),$(n.element).css({opacity:r.data.style.selected.opacity}).trigger("arrowSelect.jArcherTarget",[r.id,n.id,e.arrow]),r.data.draggable instanceof Object&&r.data.draggable?(e.createArrowPointer({x:e.convertTo.px.x(n.data.x,n.data.target),y:e.convertTo.px.y(n.data.y,n.data.target),drag:r.data.draggable,color:r.data.style.selected.color,arrowRadius:r.data.radius}),o=r.data.draggable.height+r.data.radius):o=0):t.type==="mouseover"&&(e.arrowMoving||(n.element.setAttribute("fill",r.data.style.hover.color),$(n.element).css({opacity:r.data.style.hover.opacity}).trigger("arrowOver.jArcherTarget",[r.id,n.id]))),!1}).on("mouseup mouseout click","circle",function(t){return t.type==="mouseup"?(e.setTargetStyle("initial"),n.element.setAttribute("fill",r.data.style.hover.color),r.data.draggable instanceof Object&&(e.removeArrowPointer(),n.element.setPosition({x:e.convertTo.px.x(n.data.x,n.data.target),y:e.convertTo.px.y(n.data.y,n.data.target)})),$(e.container).css({cursor:"default"}).trigger("arrowClick.jArcherTarget",[r.id,n.id,e.arrow]).trigger("arrowDeselect.jArcherTarget",[r.id,n.id,e.arrow]),e.arrowMoving=!1):t.type==="mouseout"&&(!e.arrowMoving||!r.data.draggable)&&(n.element.setAttribute("fill",r.data.style.initial.color),$(n.element).css({opacity:r.data.style.initial.opacity}).trigger("arrowOut.jArcherTarget",[r.id,n.id]),e.arrowMoving=!1),!1})},jat.Target.prototype.bindContainerEvents=function(){var e=this,t=!1,n,r,i=!1;this.draggable&&this.container.on("mousemove","svg, .targetCanvas",function(s){t&&(e.transX-=(n-s.pageX)/e.zoom,e.transY-=(r-s.pageY)/e.zoom,i=!0,e.setTransform(),n=s.pageX,r=s.pageY,e.container.trigger("targetMove.jArcherTarget",[]))}).on("mousedown","svg, .targetCanvas",function(e){t=!0,n=e.pageX,r=e.pageY,i=!1,$(this).css({cursor:"move"})}).on("mouseup","svg, .targetCanvas",function(e){t=!1,$(this).css({cursor:"default"})}),this.container.on("mousedown click",function(t){if(!i&&!$(t.target).hasClass("archerTarget-zoomin")&&!$(t.target).hasClass("archerTarget-zoomout")){var n=t.pageX-this.offsetLeft,r=t.pageY-this.offsetTop,s=e.checkClosestTarget(0,{x:n,y:r}),o=[{x:n/e.width*100,y:r/e.height*100,xPx:n,yPx:r},{x:e.convertTo.pc.x(n,s),y:e.convertTo.pc.y(r,s),target:s}];t.type==="mousedown"?e.container.trigger("containerMousedown.jArcherTarget",o):e.container.trigger("containerTap.jArcherTarget",o)}})},jat.Target.prototype.bindTargetTouchEvents=function(){var e=this;$(this.target).each(function(t,n){$(this.element).on("mouseover",function(r){return e.arrowMoving||$(n.element).css({opacity:n.style.hover.opacity}).trigger("targetOver.jArcherTarget",[t]),!1}).on("mouseout",function(r){return e.arrowMoving||$(n.element).css({opacity:n.style.initial.opacity}).trigger("targetOut.jArcherTarget",[t]),!1}).on("click",function(e){$(n.element).trigger("targetClick.jArcherTarget",[t])})})},jat.Target.prototype.bindArrowTouchEvents=function(){var e=this,t,n={},r={},i,s,o=0;this.container.on("touchmove",function(t){if(t.originalEvent.touches.length==1&&i&&s&&e.arrowMoving&&r.data.draggable){var u=t.originalEvent.touches[0];i=u.pageX-this.offsetLeft,s=u.pageY-this.offsetTop,n.element.setPosition({x:i,y:s}),r.data.draggable instanceof Object&&e.setArrowPointer({x:i,y:s,drag:r.data.draggable,arrowRadius:r.data.radius}),n.ring=e.calculateRing({x:i,y:s-o,target:n.data.target}),n.data.x=e.convertTo.pc.x(i,n.data.target),n.data.y=e.convertTo.pc.y(s-o,n.data.target),n.data.ring=n.ring,e.checkOnTarget(n.data,{x:i,y:s})&&(n.target=e.checkClosestTarget(n.data.target,{x:i,y:s}),n.data.target!==n.target&&(n.data.target=n.target,e.setTargetStyle("arrow",{active:n.data.target}))),e.arrow[r.id]=r.data,e.arrow[r.id].data[n.id]=n.data,$(n.element).trigger("arrowMove.jArcherTarget",[r.id,n.id,e.arrow])}return!1}),this.container.find(".arrowSetCanvas").on("touchstart","circle",function(t){e.arrowMoving||(n.element=this,r.id=parseInt(n.element.parentNode.id.substr(n.element.parentNode.id.indexOf("_")+1),10),r.data=e.arrow[r.id],$(this).attr("class").indexOf(" ")===-1?n.id=parseInt($(this).attr("class"),10):n.id=parseInt($(this).attr("class").substr(0,$(this).attr("class").indexOf(" ")),10),n.data=r.data.data[n.id]),!1,!t.originalEvent&&arguments[1]&&(t.originalEvent=arguments[1].originalEvent);var u=t.originalEvent.touches;return i=t.originalEvent.touches[0].pageX-this.offsetLeft,s=t.originalEvent.touches[0].pageY-this.offsetTop,e.arrowMoving=!0,r.data.draggable&&(e.setTargetStyle("arrow",{active:n.data.target}),$(e.container).css({cursor:"move"})),n.element.setAttribute("fill",r.data.style.selected.color),$(n.element).css({opacity:r.data.style.selected.opacity}).trigger("arrowSelect.jArcherTarget",[r.id,n.id,e.arrow]),r.data.draggable instanceof Object&&r.data.draggable?(e.createArrowPointer({x:e.convertTo.px.x(n.data.x,n.data.target),y:e.convertTo.px.y(n.data.y,n.data.target),drag:r.data.draggable,color:r.data.style.selected.color,arrowRadius:r.data.radius}),o=r.data.draggable.height+r.data.radius):o=0,!1}),this.container.on("touchend",function(t){if(e.arrowMoving)return!1,e.setTargetStyle("initial"),n.element.setAttribute("fill",r.data.style.hover.color),r.data.draggable instanceof Object&&(e.removeArrowPointer(),n.element.setPosition({x:e.convertTo.px.x(n.data.x,n.data.target),y:e.convertTo.px.y(n.data.y,n.data.target)})),$(e.container).css({cursor:"default"}).trigger("arrowClick.jArcherTarget",[r.id,n.id,e.arrow]).trigger("arrowDeselect.jArcherTarget",[r.id,n.id,e.arrow]),e.arrowMoving=!1,!1})},jat.Target.prototype.bindContainerTouchEvents=function(){var e=this,t=!1,n,r,i=!1,s;this.draggable&&this.container.on("touchmove","svg, .targetCanvas",function(o){t&&(e.transX-=(n-o.pageX)/e.zoom,e.transY-=(r-o.pageY)/e.zoom,i=!0,e.setTransform(),s=o.originalEvent.touches[0],n=s.pageX,r=s.pageY,e.container.trigger("targetMove.jArcherTarget",[]))}).on("touchstart","svg, .targetCanvas",function(e){s=e.originalEvent.touches[0],n=s.pageX,r=s.pageY,t=!0,i=!1,$(this).css({cursor:"move"})}).on("touchend","svg, .targetCanvas",function(e){t=!1,$(this).css({cursor:"default"})}),this.container.on("touchstart touchend",function(t){if(!i&&!$(t.target).hasClass("archerTarget-zoomin")&&!$(t.target).hasClass("archerTarget-zoomout")){var n,r;t.type==="touchstart"?(s=t.originalEvent.touches[0],n=s.pageX-this.offsetLeft,r=s.pageY-this.offsetTop):(n=t.originalEvent.x,r=t.originalEvent.y);var o=e.checkClosestTarget(0,{x:n,y:r}),u=[{x:n/e.width*100,y:r/e.height*100,xPx:n,yPx:r},{x:e.convertTo.pc.x(n,o),y:e.convertTo.pc.y(r,o),target:o},t];t.type==="touchstart"?e.container.trigger("containerMousedown.jArcherTarget",u):e.container.trigger("containerTap.jArcherTarget",u)}})},jat.Target.prototype.bindTargetEvents=function(){var e=this;$(this.target).each(function(t,n){$(this.element).on("mouseover",function(r){return e.arrowMoving||$(n.element).css({opacity:n.style.hover.opacity}).trigger("targetOver.jArcherTarget",[t]),!1}).on("mouseout",function(r){return e.arrowMoving||$(n.element).css({opacity:n.style.initial.opacity}).trigger("targetOut.jArcherTarget",[t]),!1}).on("click",function(e){$(n.element).trigger("targetClick.jArcherTarget",[t])})})},jat.Target.prototype.bindZoomEvents=function(){var e=this,t=0;this.container.on("click",".archerTarget-zoomin",function(){e.zoom<=e.maxZoom&&(t=e.zoom+e.zoomStep),e.setZoom(t)}).on("click",".archerTarget-zoomout",function(){e.zoom>=e.minZoom+e.zoomStep&&(t=e.zoom-e.zoomStep),e.setZoom(t)})},jat.Target.prototype.checkClosestTarget=function(e,t){var n,r,i,s,o=this.target[n],u=this.convertTo.canvas,a=this.target.length;for(n=0;n<a;n++){r=(u.x(o.center[0])+this.transX)*this.zoom,i=(u.y(o[n].center[1])+this.transY)*this.zoom,s=u.x(o[n].diameter)/2*this.zoom;if(t.x>r-s&&t.x<r+s&&t.y>i-s&&t.y<i+s)return n}return e},jat.Target.prototype.checkOnTarget=function(e,t){return this.target.length>=1?!0:e.x>100+t.tolerance||e.y>100+t.tolerance||e.x<-t.tolerance||e.y<-t.tolerance?!1:!0},jat.Target.prototype.createArrowPointer=function(e){this.dragMark={},this.dragMark.element=this.canvas.createGroup(!1,{id:$(this.container).attr("id")+"ArrowDrag"}),this.dragMark.rect=this.canvas.createRect({x:e.x-e.drag.width/2,y:e.y-e.drag.height-e.arrowRadius,width:e.drag.width,height:e.drag.height,fill:e.color}),this.dragMark.element.appendChild(this.dragMark.rect),this.dragMark.circle=this.canvas.createCircle({x:e.x,y:e.y-e.drag.height-e.arrowRadius,radius:e.drag.width,fill:e.color,stroke:!1,eleClass:!1}),this.dragMark.element.appendChild(this.dragMark.circle),this.canvas.canvas.appendChild(this.dragMark.element)},jat.Target.prototype.createArrows=function(e){var t=this,n,r,i,s,o={height:40,width:5};e||(e=[]),t.arrowGroup=t.canvas.createGroup(!1,{id:t.container.attr("id")+"ArrowContainer"}),t.canvas.canvas.appendChild(t.arrowGroup);var u=e.length;for(n=0;n<u;n++){var a=e[n];a=a instanceof Array?{data:a}:a,a=$.extend(!0,{},t.params.arrowDefaults,a),a.draggable instanceof Object&&(a.draggable=$.extend(!0,{},o,a.draggable)),a.element=t.canvas.createGroup(!1,{id:$(t.container).attr("id")+"ArrowSet_"+n,eleClass:"arrowSetCanvas"});var f=a.data.length;for(r=0;r<f;r++){var l=a.data[r];t.target[a.target]||(a.target=0),l.target=l.target?l.target:a.target,t.target[l.target]||(l.target=0),typeof l.active=="undefined"&&(l.active=a.active),i=l.active?"":" hidden",l.element=t.canvas.createCircle({x:t.convertTo.px.x(l.x,l.target),y:t.convertTo.px.y(l.y,l.target),radius:a.radius,fill:a.style.initial.color,stroke:a.style.initial.stroke,eleClass:r+i}),$(l.element).css({opacity:a.style.initial.opacity}),$(a.element).append(l.element)}t.arrowGroup.appendChild(a.element)}return!1,e},jat.Target.prototype.createTarget=function(e){var t,n,r=this;e=e||[];for(t=0;t<e.length;t++){e[t]=$.extend(!0,{},this.params.targetDefaults,e[t]),e[t].originalCenter=e[t].center,e[t].element=this.canvas.createGroup(!1,{id:$(this.container).attr("id")+"Target_"+t,eleClass:"targetCanvas"}),e[t].rings=[];for(n=0;n<jat.Target.targets[e[t].name].numberRings;n++)e[t].rings[n]={},e[t].rings[n].element=this.canvas.createCircle({x:this.convertTo.canvas.x(e[t].center[0]),y:this.convertTo.canvas.y(e[t].center[1]),radius:this.convertTo.canvas.x(jat.Target.targets[e[t].name].diameters[n],e[t].diameter)/2,fill:jat.Target.targets[e[t].name].colors[n],stroke:jat.Target.targets[e[t].name].strokeColors[n],eleClass:n}),$(e[t].element).append(e[t].rings[n].element);this.rootGroup.appendChild(e[t].element),$(e[t].element).css({opacity:e[t].style.initial.opacity})}return!1,e},jat.Target.prototype.calculateRing=function(e){var t,n=this.target[e.target],r=jat.Target.targets[n.name],i={x:0,y:0,diagonal:0},s={x:(this.convertTo.canvas.x(n.center[0])+this.transX)*this.zoom,y:(this.convertTo.canvas.y(n.center[1])+this.transY)*this.zoom,radius:this.convertTo.canvas.x(n.diameter)/2*this.zoom,numberRings:r.numberRings};e.x>=s.x?i.x=s.x-e.x:i.x=e.x-s.x,e.y>=s.y?i.y=e.y-s.y:i.y=s.y-e.y,i.x===0&&i.y===0?i.diagonal=0:i.diagonal=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2));if(!(i.diagonal<=s.radius+1))return 0;for(t=s.numberRings-1;t>=0;t--)if(i.diagonal<=this.convertTo.canvas.x(r.diameters[t],n.diameter)/2*this.zoom+1)return r.rating[t]},jat.Target.prototype.getArrows=function(){return this.arrow},jat.Target.prototype.getRing=function(e){var t,n;if(e)return this.calculateRing({x:this.convertTo.px.x(e.x,e.target),y:this.convertTo.px.y(e.y,e.target),target:e.target});for(t=0;t<this.arrow.length;t++)for(n=0;n<this.arrow[t].data.length;n++)this.arrow[t].data[n].ring=this.calculateRing({x:this.convertTo.px.x(this.arrow[t].data[n].x,this.arrow[t].data[n].target),y:this.convertTo.px.y(this.arrow[t].data[n].y,this.arrow[t].data[n].target),target:this.arrow[t].data[n].target});return this.arrow},jat.Target.prototype.getTargetParams=function(e){return jat.Target.targets[e]},jat.Target.prototype.getTransform=function(){var e={x:this.transX,y:this.transY,scale:this.zoom};return e},jat.Target.prototype.removeArrowPointer=function(){this.canvas.canvas.removeChild(this.dragMark.element)},jat.Target.prototype.setArrowActive=function(e){var t=this,n,r=function(e,n,r){typeof r=="undefined"?r=t.arrow[e].data[n].active:t.arrow[e].data[n].active=r;var i=t.arrow[e].data[n].element,s=r?"":" hidden";i.setAttribute("class",n+s)},i=function(e,i){typeof i!="undefined"&&(t.arrow[e].active=i);for(n=0;n<t.arrow[e].data.length;n++)r(e,n,i)};typeof e.arrowID!="undefined"?r(e.arrowsetID,e.arrowID,e.active):i(e.arrowsetID,e.active)},jat.Target.prototype.setArrowOptions=function(e){var t=this,n,r,i;for(n in e.options)if(e.options.hasOwnProperty(n)){r="setArrow"+n.charAt(0).toUpperCase()+n.substr(1);if(e.options[n]!==t.arrow[e.arrowsetID][n])switch(n){case"active":t[r]({arrowsetID:e.arrowsetID,active:e.options[n]});break;default:}}$.extend(!0,t.arrow[e.arrowsetID],e.options)},jat.Target.prototype.setArrowPointer=function(e){this.dragMark.rect.setPosition({x:e.x-e.drag.width/2,y:e.y-e.drag.height-e.arrowRadius}),this.dragMark.circle.setPosition({x:e.x,y:e.y-e.drag.height-e.arrowRadius})},jat.Target.prototype.setArrowPosition=function(e){var t,n,r=this,i={},s=function(e,t){r.arrow[e].data[t].element.setPosition({x:r.convertTo.px.x(r.arrow[e].data[t].x,r.arrow[e].data[t].target),y:r.convertTo.px.y(r.arrow[e].data[t].y,r.arrow[e].data[t].target)})};if(typeof e=="undefined"){!1;for(t=0;t<r.arrow.length;t++)for(n=0;n<r.arrow[t].data.length;n++)s(t,n)}else{e=$.extend({},i,e);if(e.arrowsetID instanceof Array)for(t=0;t<e.arrowsetID.length;t++)for(n=0;n<r.arrow[e.arrowsetID[t]].data.length;n++)s(e.arrowsetID[t],n);else if(typeof e.arrowID!="undefined")if(e.arrowID instanceof Array)for(t=0;t<e.arrowID.length;t++)s(e.arrowsetID,e.arrowID[t]);else s(e.arrowsetID,e.arrowID);else{s(e.arrowsetID,e.active);for(t=0;t<r.arrow[e.arrowsetID].data.length;t++)s(e.arrowsetID,t)}}},jat.Target.prototype.setArrowStyle=function(e){var t=this,n,r,i={style:this.params.arrowDefaults.style.initial},s=function(e,n){var i;n.radius||(n.radius=t.arrow[e].radius);for(r=0;r<t.arrow[e].data.length;r++)i=t.arrow[e].data[r],i.element.setStyle({stroke:n.stroke,radius:n.radius,fill:n.color}),$(i.element).css({opacity:n.opacity})},o=function(e,n,r){var i=t.arrow[e].data[n];r.radius||(r.radius=t.arrow[e].radius),i.element.setStyle({stroke:r.stroke,radius:r.radius,fill:r.color}),$(i.element).css({opacity:r.opacity})};e=$.extend({},i,e);if(e.arrowsetID instanceof Array)if(e.style instanceof Array)for(n=0;n<e.arrowsetID.length;n++)s(e.arrowsetID[n],e.style[n]);else for(n=0;n<e.arrowsetID.length;n++)s(e.arrowsetID[n],e.style);else if(typeof e.arrowID!="undefined")if(e.arrowID instanceof Array)if(e.style instanceof Array)for(n=0;n<e.arrowID.length;n++)o(e.arrowsetID,e.arrowID[n],e.style[n]);else for(n=0;n<e.arrowID.length;n++)o(e.arrowsetID,e.arrowID[n],e.style);else o(e.arrowsetID,e.arrowID,e.style);else s(e.arrowsetID,e.style)},jat.Target.prototype.setBackgroundColor=function(e){this.backgroundColor=e,this.container.css({backgroundColor:e})},jat.Target.prototype.setGap=function(){var e;this.gap=[],this.clearConverterCache();for(e=0;e<this.target.length;e++)this.gap[e]={top:this.convertTo.canvas.y(this.target[e].center[1])-this.convertTo.canvas.x(this.target[e].diameter/2),left:this.convertTo.canvas.x(this.target[e].center[0]-this.target[e].diameter/2)}},jat.Target.prototype.setSize=function(){this.width=this.container.width(),this.height=this.container.height()?this.container.height():this.container.width()},jat.Target.prototype.setTargetStyle=function(e,t){var n;switch(e){case"initial":for(n=0;n<this.target.length;n++)$(this.target[n].element).css({opacity:this.target[n].style.initial.opacity});break;case"arrow":for(n=0;n<this.target.length;n++)n===t.active?$(this.target[n].element).css({opacity:this.target[n].style.arrowOn.opacity}):$(this.target[n].element).css({opacity:this.target[n].style.arrowOff.opacity})}},jat.Target.prototype.setTransform=function(e,t,n){!e&&e!==0?e=this.transX:this.transX=e,!t&&t!==0?t=this.transY:this.transY=t,n?this.zoom=n:n=this.zoom,this.clearConverterCache(),this.canvas.applyTransformParams(n,e,t),this.setArrowPosition()},jat.Target.prototype.setZoom=function(e){this.container.trigger("zoom.jArcherTarget",[e,this.zoom]),this.zoom=e,this.setTransform(),this.clearConverterCache()},jat.VectorCanvas=function(e,t){this.mode=window.SVGAngle?"svg":"vml";if(this.mode==="svg")this.createSvgNode=function(e){return document.createElementNS(this.svgns,e)};else{try{document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),this.createVmlNode=function(e){return document.createElement("<rvml:"+e+' class="rvml">')}}catch(n){this.createVmlNode=function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}this.mode==="svg"?this.canvas=this.createSvgNode("svg"):(this.canvas=this.createVmlNode("group"),this.canvas.style.position="absolute"),this.setSize(e,t)},jat.VectorCanvas.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(e,t){var n,r,i;if(this.mode==="svg")this.canvas.setAttribute("width",e),this.canvas.setAttribute("height",t);else{this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.coordsize=e+" "+t,this.canvas.coordorigin="0 0";if(this.rootGroup){i=this.rootGroup.getElementsByTagName("shape");for(n=0,r=i.length;n<r;n++)i[n].coordsize=e+" "+t,i[n].style.width=e+"px",i[n].style.height=t+"px";this.rootGroup.coordsize=e+" "+t,this.rootGroup.style.width=e+"px",this.rootGroup.style.height=t+"px"}}this.width=e,this.height=t},createCircle:function(e){var t;return this.mode==="svg"?(t=this.createSvgNode("circle"),t.setAttribute("cx",e.x),t.setAttribute("cy",e.y),t.setAttribute("r",e.radius),t.setAttribute("fill",e.fill),t.setAttribute("stroke",e.stroke),t.setAttribute("class",e.eleClass),t.setPosition=function(e){t.setAttribute("cx",e.x),t.setAttribute("cy",e.y)},t.setStyle=function(e){t.setAttribute("r",e.radius),t.setAttribute("fill",e.fill),t.setAttribute("stroke",e.stroke)}):(t=this.createVmlNode("oval"),t.style.width=e.radius*2+"px",t.style.height=e.radius*2+"px",t.style.left=e.x-e.radius+"px",t.style.top=e.y-e.radius+"px",t.fillcolor=e.fill,$(t).addClass("config.eleClass"),t.stroke=!0,t.strokecolor=e.stroke,t.setPosition=function(n){t.style.left=n.x-e.radius+"px",t.style.top=n.y-e.radius+"px"},t.setStyle=function(e){t.style.width=e.radius*2+"px",t.style.height=e.radius*2+"px",t.fillcolor=e.fill,t.stroke=!0,t.strokecolor=e.stroke}),t},createRect:function(e){var t;return this.mode==="svg"?(t=this.createSvgNode("rect"),t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("fill",e.fill),t.setPosition=function(e){t.setAttribute("x",e.x),t.setAttribute("y",e.y)}):(t=this.createVmlNode("rect"),t.style.width=e.width+"px",t.style.height=e.width+"px",t.style.left=e.x+"px",t.style.top=e.y+"px",t.fillcolor=e.fill,t.setPosition=function(e){t.style.left=e.x+"px",t.style.top=e.y+"px"}),t},createGroup:function(e,t){var n;return t=t||{},this.mode==="svg"?(n=this.createSvgNode("g"),t.id&&(n.id=t.id),t.eleClass&&n.setAttribute("class",t.eleClass)):(n=this.createVmlNode("group"),n.style.width=this.width+"px",n.style.height=this.height+"px",n.style.left="0px",n.style.top="0px",n.coordorigin="0 0",t.id&&(n.id=t.id),t.eleClass&&$(n).addClass("config.eleClass"),n.coordsize=this.width+" "+this.height),e&&(this.rootGroup=n),n},applyTransformParams:function(e,t,n){this.mode==="svg"?this.rootGroup.setAttribute("transform","scale("+e+") translate("+t+", "+n+")"):(this.rootGroup.coordorigin=this.width-t-this.width/100+","+(this.height-n-this.height/100),this.rootGroup.coordsize=this.width/e+","+this.height/e)}};